<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="fragments :: page_head('Manage Users')">
</head>

<body>

    <!-- nav bar-->
    <div th:replace="navigation :: menu"></div>

    <!-- Body -->
    <div class="container-fluid">
	    <div>
	    	<div class="pb-3">
	    		<h1>Manage Users</h1>
	    		<a class="btn btn-primary btn-info" th:href="@{/users/new}">Create New User</a>
	    		<a class="btn btn-primary btn-danger" th:href="@{/users/export/csv}">Export to CSV</a>
	    		<a class="btn btn-primary btn-warning" th:href="@{/users/export/excel}">Export to Excel</a>
	    	</div>
	    </div>
	    
	    <div th:if="${message != null}" class="alert alert-success pt-3" th:text="${message}" >
	    </div>

        <div >
            <form th:action="@{/users/page/1}" class="form-inline d-flex flex-wrap">
                <input type="hidden" name="sortField" th:value="${sortField}">
                <input type="hidden" name="sortDir" th:value="${sortDir}">
                <label class="my-1 mr-2"> <b>Filters  &nbsp;&nbsp; </b></label>
                <input type="search" name="keyWord" th:value="${keyWord}" class="form-control mb-2 mr-sm-2" style="max-width:300px" required />
                &nbsp;&nbsp;
                <input type="submit" value="Search" class="btn btn-primary mb-2 mr-sm-2" />
                &nbsp;&nbsp;
                <input type="button" value="Clear" class="btn btn-secondary mb-2" onclick="clearFilter()" />
            </form>
        </div>

	    <div class="pt-2">
	    	<table class="table table-responsive-xl table-bordered table-striped table-hover " >
	    		<thead class=" gradient-bg">
	    			<tr>
                        <!-- Call fragment -->
		    			<th th:replace="fragments :: column_link('id', 'User Id')"></th>
		    			<th>Photos</th>
                        <th th:replace="fragments :: column_link('email', 'Email')"></th>
                        <th th:replace="fragments :: column_link('firstName', 'First Name')"></th>
                        <th th:replace="fragments :: column_link('lastName', 'Last Name')"></th>
                        <th >Roles</th>
                        <th th:replace="fragments :: column_link('enabled', 'Enabled')"></th>
		    			<th></th>
	    			</tr>
	    		</thead>
	    		<tbody>
	    			<tr th:each="user : ${listUsers}">
	    				<td>[[${user.id}]]</td>
	    				<td>
                            <span th:if="${user.photos == null}" class="fas fa-portrait fa-3x icon-dark"></span>
                            <img th:if="${user.photos != null}" th:src="@{${user.photosImagePath}}" style="max-width : 70px">
                        </td>
	    				<td>[[${user.email}]]</td>
	    				<td>[[${user.firstName}]]</td>
	    				<td>[[${user.lastName}]]</td>
	    				<td>[[${user.roles}]]</td>
	    				<td>
                            <a th:if="${user.enabled == true}" class="fas fa-check-circle fa-2x icon-green"
                               th:href="@{'/users/' + ${user.id} + '/enabled/false'}" title="Disable user"></a>

                            <a th:if="${user.enabled != true}" class="fas fa-circle fa-2x icon-dark"
                               th:href="@{'/users/' + ${user.id} + '/enabled/true'}" title="Enable user"></a>
                        </td>
	    				<td>
                            <a class="fas fa-edit fa-2x icon-orange" th:href="@{'/users/edit/' + ${user.id}}" title="Edit the user">

                            </a>
	    					 &nbsp;
                            &nbsp;
                            <a class="fas fa-trash fa-2x icon-silver link-delete"
                               th:href="@{'/users/delete/' + ${user.id}}" title="Delete the user"
                               th:id="${user.id}"
                            >

                            </a>
	    				</td>
	    			</tr>
	    		</tbody>
	    	</table>
	    </div>


        <div class="text-center m-1" th:if="${startCount < endCount}">
            <span>Showing user # [[${startCount}]] to [[${endCount}]] of [[${totalItems}]]</span>
        </div>
        <div class="text-center m-1" th:unless="${startCount < endCount}">
            <span>No user found</span>
        </div>



        <!--pagination-->
        <div th:if="${totalItems > 0}">
            <nav>
                <ul class="pagination justify-content-center">
                    <!-- Link to the first page -->
                    <li th:class="${currentPage > 1} ? 'page-item' : 'page-item disabled'">
                        <a class="page-link" th:href="@{'/users/page/1?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''} }">First</a>
                    </li>
                    <!-- Link to the previous page -->
                    <li th:class="${currentPage > 1} ? 'page-item' : 'page-item disabled'">
                        <a class="page-link" th:href="@{'/users/page/' + ${currentPage - 1} + '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">Previous</a>
                    </li>
                    <!-- Link to the first page if current page is greater than 2 -->
                    <li th:if="${currentPage > 2}" class="page-item">
                        <a class="page-link" th:href="@{'/users/page/' + 1+ '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">1</a>
                    </li>
                    <!-- Dots before the current page -->
                    <li th:if="${currentPage > 3}" class="page-item disabled">
                        <a class="page-link">...</a>
                    </li>
                    <!-- Links for the current, previous, and next page -->
                    <li th:each="i : ${#numbers.sequence(currentPage - 1 > 1 ? currentPage - 1 : 1, currentPage + 1 < totalPages ? currentPage + 1 : totalPages)}"
                        th:class="${currentPage == i} ? 'page-item active' : 'page-item'">
                        <a class="page-link" th:href="@{'/users/page/' + ${i} + '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">[[${i}]]</a>
                    </li>
                    <!-- Dots after the current page -->
                    <li th:if="${currentPage < totalPages - 2}" class="page-item disabled">
                        <a class="page-link">...</a>
                    </li>
                    <!-- Link to the last page if current page is less than total pages minus 1 -->
                    <li th:if="${currentPage < totalPages - 1}" class="page-item">
                        <a class="page-link" th:href="@{'/users/page/' + ${totalPages} + '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">[[${totalPages}]]</a>
                    </li>
                    <!-- Link to the next page -->
                    <li th:class="${currentPage < totalPages} ? 'page-item' : 'page-item disabled'">
                        <a class="page-link" th:href="@{'/users/page/' + ${currentPage + 1} + '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">Next</a>
                    </li>
                    <!-- Link to the last page -->
                    <li th:class="${currentPage < totalPages} ? 'page-item' : 'page-item disabled'">
                        <a class="page-link" th:href="@{'/users/page/' + ${totalPages} + '?sortField=' + ${sortField} + '&sortDir='+${sortDir}+ ${keyWord != null ? '&keyWord=' + keyWord : ''}}">Last</a>
                    </li>
                </ul>
            </nav>
        </div>


    </div>
    <div th:replace="fragments :: footer"></div>

    <!-- Model dialog Delete user-->
    <div class="modal fade text-center" id="deleteConfirm">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" >Delete Confirmation</h4>
                    <button type="button" class="close" data-bs-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <span id="modalBody">
                    </span>
                </div>

                <div class="modal-footer">
                    <a class="btn btn-success" href="" id="yesBtn" >Yes</a>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">No</button>

                </div>
            </div>
        </div>
    </div>


    </div>



    



<script>
    $(document).ready(function () {
        $(".link-delete").on("click", function(e) {
            e.preventDefault();
            link = $(this)
            $("#yesBtn").attr("href", link.attr("href"));
            //alert($(this).attr("href"));
            id = link.attr("id");
            $("#modalBody").text("Are you sure to want to delete the user id = " + id + " ?");
            $("#deleteConfirm").modal('show');
        });
    });


    function clearFilter() {
        window.location = "[[@{/users}]]" ;
    }
</script>

</body>


</html>
